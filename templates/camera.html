<html>

<body>
  <video hidden id="video" width="640" height="480" autoplay></video>
  <div id="content"></div>
  <script>
    const video = document.getElementById('video');

    // Get the video stream from the camera
    navigator.mediaDevices.getUserMedia({ video: true })
      .then(stream => {
        video.srcObject = stream;
        // Set up the interval to send frames to the server every 500 milliseconds
        setInterval(() => {
          // Get the current frame from the video stream
          const canvas = document.createElement('canvas');
          canvas.width = video.videoWidth;
          canvas.height = video.videoHeight;
          canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
          const frame = canvas.toDataURL('image/jpeg', 0.8);

          // Send the frame to the Flask server using the fetch() method
          fetch('/stream', {
            method: 'POST',
            body: JSON.stringify({ frame }),
            headers: {
              'Content-Type': 'application/json'
            }
          })
            .then((html) => {
              const output_thing = Promise.resolve(html.text());
              output_thing.then((value) => {
                document.getElementById('content').innerHTML = value;
              });
            })
            .catch(error => {
              console.error('Error uploading frame:', error);
            });
        }, 10000);
      })
      .catch(error => {
        console.error('Error getting video stream:', error);
      });

  </script>
</body>

</html>